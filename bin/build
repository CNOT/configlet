#!/bin/bash

set -e -x

EXECUTABLE_NAME="configlet"

PLATFORMS="darwin/386 darwin/amd64 linux/386 linux/amd64 windows/386 windows/amd64"

function build-architecture {
	GOOS=${1%/*}
	GOARCH=${1#*/}
	echo "Creating $GOOS $GOARCH binary..."

	EXT=""
	if [ $GOOS == windows ]; then
		EXT=".exe"
	fi

	FILE=$EXECUTABLE_NAME$EXT

	GOOS=$GOOS GOARCH=$GOARCH go build -o out/$FILE

	cd out
	ZIP=../build/$EXECUTABLE_NAME-$GOOS-$GOARCH.tgz
	tar cvzf $ZIP $FILE
	cd ..
}

for PLATFORM in $PLATFORMS; do
  build-architecture $PLATFORM
done
